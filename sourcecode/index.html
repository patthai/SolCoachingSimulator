<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOL - ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á T-GROW</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --navy-blue: #0A0B5A;
      --mint-green: #C0F0AA;
      --light-mint: #E3FFDA;
      --dark-gray: #333333;
      --light-gray: #f8f9fa;
    }

    body {
      font-family: 'Prompt', sans-serif;
      background-color: var(--light-gray);
      color: var(--dark-gray);
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 2rem;
    }

    .step-container {
      display: none;
      opacity: 0;
      transform: translateY(20px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .step-container.active {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .btn {
      transition: all 0.3s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .chat-message {
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.3s ease, transform 0.3s ease;
      animation-fill-mode: forwards;
    }

    .chat-message.visible {
      opacity: 1;
      transform: translateY(0);
    }

    .progress-bar {
      height: 6px;
      background-color: #e9ecef;
      border-radius: 3px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--navy-blue) 0%, var(--mint-green) 100%);
      transition: width 0.5s ease;
    }

    textarea {
      resize: none;
      transition: border-color 0.3s ease;
      font-family: 'Prompt', sans-serif;
    }

    textarea:focus {
      outline: none;
      border-color: var(--navy-blue);
      box-shadow: 0 0 0 3px rgba(10, 11, 90, 0.2);
    }

    .feedback-container {
      border-left: 3px solid var(--navy-blue);
      padding-left: 1rem;
      margin: 1rem 0;
      background-color: var(--light-mint);
      padding: 1rem;
      border-radius: 0 0.5rem 0.5rem 0;
    }

    .feedback-entry {
      margin-bottom: 1rem;
      padding-bottom: 1rem;
      border-bottom: 1px dashed #ccc;
    }

    .feedback-entry:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    /* Logo styling */
    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .logo span:first-child {
      color: var(--navy-blue);
    }

    .logo span:last-child {
      color: var(--mint-green);
    }

    /* Info section styling */
    .info-section {
      background-color: var(--light-mint);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-bottom: 1.5rem;
      border-left: 3px solid var(--navy-blue);
    }

    /* Standalone loading animation */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .loading-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .loading-spinner {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Card-based feedback styling */
    .card-container {
      margin-bottom: 1.5rem;
      max-height: 400px;
      overflow-y: auto;
    }

    .input-card {
      margin-bottom: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      animation: slideIn 0.3s ease-out;
    }

    .card-header {
      padding: 0.75rem 1rem;
      background-color: var(--navy-blue);
      color: white;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .card-number {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 12px;
      font-size: 0.75rem;
      margin-right: 8px;
      background-color: white;
      color: var(--navy-blue);
    }

    .card-content {
      padding: 1rem;
      background-color: white;
    }

    .feedback-section {
      background-color: var(--light-mint);
      padding: 1rem;
      border-top: 1px dashed #ccc;
    }

    .refinement-counter {
      display: inline-flex;
      align-items: center;
      padding: 0.25rem 0.75rem;
      background-color: var(--light-mint);
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .loading-dots {
      display: inline-flex;
      align-items: center;
      height: 20px;
      margin-bottom: 1rem;
    }

    .loading-dots span {
      width: 12px;
      height: 12px;
      margin: 0 4px;
      background-color: var(--navy-blue);
      border-radius: 50%;
      display: inline-block;
      animation: dots 1.4s infinite ease-in-out both;
    }

    .loading-dots span:nth-child(1) {
      animation-delay: -0.32s;
    }

    .loading-dots span:nth-child(2) {
      animation-delay: -0.16s;
    }

    @keyframes dots {

      0%,
      80%,
      100% {
        transform: scale(0);
      }

      40% {
        transform: scale(1);
      }
    }

    /* AI typing animation */
    .typing-indicator {
      display: inline-block;
      position: relative;
      margin-left: 5px;
    }

    .typing-indicator span {
      width: 8px;
      height: 8px;
      margin: 0 2px;
      background-color: var(--navy-blue);
      border-radius: 50%;
      display: inline-block;
      animation: typing 1s infinite ease-in-out both;
    }

    .typing-indicator span:nth-child(1) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.4s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.6s;
    }

    @keyframes typing {
      0% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-5px);
      }

      100% {
        transform: translateY(0);
      }
    }

    /* Custom button styles */
    .btn-primary {
      background-color: var(--navy-blue);
      color: white;
    }

    .btn-primary:hover {
      background-color: #161785;
    }

    .btn-secondary {
      background-color: #e9ecef;
      color: var(--dark-gray);
    }

    .btn-secondary:hover {
      background-color: #dee2e6;
    }

    /* Badge for steps */
    .step-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 24px;
      height: 24px;
      border-radius: 12px;
      font-size: 0.75rem;
      margin-right: 8px;
      background-color: var(--navy-blue);
      color: white;
    }

    /* Emoji in headings */
    .emoji {
      font-size: 1.5rem;
      margin-right: 0.5rem;
      vertical-align: middle;
    }

    /* Animation classes */
    .animate-fadeInUp {
      animation: fadeInUp 0.8s ease forwards;
      opacity: 0;
    }

    .animate-fadeIn {
      animation: fadeIn 0.8s ease forwards;
      opacity: 0;
    }

    .animate-scaleIn {
      animation: scaleIn 0.8s ease forwards;
      opacity: 0;
      transform: scale(0.9);
    }

    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes scaleIn {
      from {
        opacity: 0;
        transform: scale(0.9);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* New animations for text components */
    @keyframes slideInFromLeft {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInFromRight {
      from {
        opacity: 0;
        transform: translateX(20px);
      }

      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes popIn {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    .animate-slideFromLeft {
      animation: slideInFromLeft 0.6s ease forwards;
      opacity: 0;
    }

    .animate-slideFromRight {
      animation: slideInFromRight 0.6s ease forwards;
      opacity: 0;
    }

    .animate-popIn {
      animation: popIn 0.6s ease forwards;
      opacity: 0;
    }

    /* Initial invisible state for elements to be animated */
    .hidden-animation {
      opacity: 0;
    }
  </style>
</head>

<body>
  <!-- Loading Overlay -->
  <div id="loading-overlay" class="loading-overlay">
    <div class="loading-spinner">
      <div class="loading-dots">
        <span></span>
        <span></span>
        <span></span>
      </div>
      <p class="text-center text-gray-600">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...</p>
    </div>
  </div>

  <!-- Landing Page with Enhanced Animations -->
  <div id="landing-page" class="fixed inset-0 bg-white z-50 flex items-center justify-center">
    <div class="text-center px-4 max-w-lg">
      <div class="logo mb-8 animate-fadeInUp" style="animation-delay: 0.3s;">
        <span class="text-5xl font-bold">
          <span class="text-navy-blue">SO</span><span class="text-mint-green">L</span>
        </span>
      </div>

      <h1 class="text-3xl font-bold mb-4 animate-fadeInUp" style="animation-delay: 0.6s;">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á T-GROW</h1>

      <p class="text-gray-600 mb-8 animate-fadeInUp" style="animation-delay: 0.9s;">
        ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ T-GROW
        <br>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏¥‡∏ö‡πÇ‡∏ï‡∏Å‡∏±‡∏ô‡πÄ‡∏•‡∏¢!
      </p>

      <div class="flex flex-col items-center animate-fadeInUp" style="animation-delay: 1.2s;">
        <div class="flex mb-6">
          <div class="bg-navy-blue text-white rounded-full w-10 h-10 flex items-center justify-center mx-2">T</div>
          <div class="bg-navy-blue text-white rounded-full w-10 h-10 flex items-center justify-center mx-2">G</div>
          <div class="bg-navy-blue text-white rounded-full w-10 h-10 flex items-center justify-center mx-2">R</div>
          <div class="bg-navy-blue text-white rounded-full w-10 h-10 flex items-center justify-center mx-2">O</div>
          <div class="bg-navy-blue text-white rounded-full w-10 h-10 flex items-center justify-center mx-2">W</div>
        </div>

        <div class="text-sm text-gray-600 mb-8">
          <div><strong>T</strong>opic - ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠</div>
          <div><strong>G</strong>oal - ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢</div>
          <div><strong>R</strong>eality - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
          <div><strong>O</strong>ptions - ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>
          <div><strong>W</strong>ill - ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£</div>
        </div>
      </div>

      <button id="start-button" class="btn btn-primary px-10 py-3 rounded-lg font-medium text-lg animate-scaleIn"
        style="animation-delay: 1.5s;" onclick="startCoaching()">
        Start Coaching üöÄ
      </button>
    </div>
  </div>

  <div class="container" style="display: none;">
    <header class="text-center mb-8">
      <div class="logo">
        <span>SO</span><span>L</span>
      </div>
      <p class="text-gray-600">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‚ú®</p>

      <div class="progress-bar mt-8">
        <div class="progress-bar-fill" id="progressBar" style="width: 0%"></div>
      </div>

      <div class="flex justify-center space-x-2 text-sm text-gray-500">
        <span id="step-topic" class="font-medium text-navy-blue">Topic</span>
        <span>‚Üí</span>
        <span id="step-goal">Goal</span>
        <span>‚Üí</span>
        <span id="step-reality">Reality</span>
        <span>‚Üí</span>
        <span id="step-options">Options</span>
        <span>‚Üí</span>
        <span id="step-will">Will</span>
        <span>‚Üí</span>
        <span id="step-coach">Coach</span>
        <span>‚Üí</span>
        <span id="step-reflection">Reflection</span>
      </div>
    </header>

    <!-- Topic Step -->
    <div id="topic-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üéØ</span> Topic - ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô</h2>
      <p class="text-gray-600 mb-6">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏≠‡∏∞‡πÑ‡∏£‡∏Å‡∏±‡∏ô‡∏î‡∏µ‡∏Ñ‡∏∞? ‡∏ä‡πà‡∏ß‡∏¢‡∏ö‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≤‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~
      </p>

      <div id="topic-container" class="mb-6">
        <div id="topic-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="topic-input" class="w-full p-4 border rounded-lg mb-4 h-32"
            placeholder="‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á..."></textarea>
          <div class="flex justify-between items-center">
            <div class="refinement-counter">
              <span>Refinements left: <span id="topic-refinements-left" class="font-bold text-navy-blue">3</span></span>
            </div>
            <button id="submit-topic" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <span></span>
          <button id="next-to-goal" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Goal
            ‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <!-- Goal Step -->
    <div id="goal-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üèÜ</span> Goal - ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
      <p class="text-gray-600 mb-2">‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏∞‡πÑ‡∏£‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞?</p>
      <p class="text-gray-600 mb-6">‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô ‡∏ß‡∏±‡∏î‡∏ú‡∏•‡πÑ‡∏î‡πâ ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏à‡∏£‡∏¥‡∏á‡πÜ ‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡πà‡∏≤~</p>

      <div class="info-section bg-light-mint p-3 rounded-lg mb-4">
        <div class="flex items-center mb-2">
          <span class="text-lg mr-2">üîç</span>
          <strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ:</strong>
        </div>
        <p id="selected-topic" class="text-gray-700 pl-6"></p>
      </div>

      <div id="goal-container" class="mb-6">
        <div id="goal-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="goal-input" class="w-full p-4 border rounded-lg mb-4 h-32"
            placeholder="‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠..."></textarea>
          <div class="flex justify-between items-center">
            <button id="back-to-topic" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
            <div class="flex items-center">
              <div class="refinement-counter mr-4">
                <span>Refinements left: <span id="goal-refinements-left"
                    class="font-bold text-navy-blue">3</span></span>
              </div>
              <button id="submit-goal" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <span></span>
          <button id="next-to-reality" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Reality
            ‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <!-- Reality Step -->
    <div id="reality-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üîç</span> Reality - ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</h2>
      <p class="text-gray-600 mb-6">‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞? ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡πâ‡∏≤‡∏ó‡∏≤‡∏¢‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∏‡∏õ‡∏™‡∏£‡∏£‡∏Ñ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏à‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏°?
      </p>

      <div class="info-section bg-light-mint p-3 rounded-lg mb-4">
        <div class="flex items-center mb-2">
          <span class="text-lg mr-2">üîç</span>
          <strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ:</strong>
        </div>
        <p id="selected-goal" class="text-gray-700 pl-6"></p>
      </div>

      <div id="reality-container" class="mb-6">
        <div id="reality-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="reality-input" class="w-full p-4 border rounded-lg mb-4 h-32"
            placeholder="‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ñ‡∏∑‡∏≠..."></textarea>
          <div class="flex justify-between items-center">
            <button id="back-to-goal" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
            <div class="flex items-center">
              <div class="refinement-counter mr-4">
                <span>Refinements left: <span id="reality-refinements-left"
                    class="font-bold text-navy-blue">3</span></span>
              </div>
              <button id="submit-reality" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <span></span>
          <button id="next-to-options" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Options
            ‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <!-- Options Step -->
    <div id="options-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üß†</span> Options - ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
      <p class="text-gray-600 mb-6">‡∏°‡∏µ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏û‡∏≤‡πÄ‡∏£‡∏≤‡πÑ‡∏õ‡∏ñ‡∏∂‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÑ‡∏î‡πâ? ‡∏•‡∏≠‡∏á‡∏Ñ‡∏¥‡∏î‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏∞~</p>

      <div class="info-section bg-light-mint p-3 rounded-lg mb-4">
        <div class="flex items-center mb-2">
          <span class="text-lg mr-2">üîç</span>
          <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ:</strong>
        </div>
        <p id="selected-reality" class="text-gray-700 pl-6"></p>
      </div>

      <div id="options-container" class="mb-6">
        <div id="options-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="options-input" class="w-full p-4 border rounded-lg mb-4 h-32"
            placeholder="‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠..."></textarea>
          <div class="flex justify-between items-center">
            <button id="back-to-reality" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
            <div class="flex items-center">
              <div class="refinement-counter mr-4">
                <span>Refinements left: <span id="options-refinements-left"
                    class="font-bold text-navy-blue">3</span></span>
              </div>
              <button id="submit-options" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <span></span>
          <button id="next-to-will" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Will
            ‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <!-- Will Step -->
    <div id="will-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üöÄ</span> Will - ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
      <p class="text-gray-600 mb-6">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£‡∏ï‡πà‡∏≠‡πÑ‡∏õ? ‡πÄ‡∏•‡πà‡∏≤‡πÅ‡∏ú‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏≤~</p>

      <div class="info-section bg-light-mint p-3 rounded-lg mb-4">
        <div class="flex items-center mb-2">
          <span class="text-lg mr-2">üîç</span>
          <strong>‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏Ñ‡∏¥‡∏î‡πÑ‡∏ß‡πâ:</strong>
        </div>
        <p id="selected-options" class="text-gray-700 pl-6"></p>
      </div>

      <div id="will-container" class="mb-6">
        <div id="will-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="will-input" class="w-full p-4 border rounded-lg mb-4 h-32"
            placeholder="‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠..."></textarea>
          <div class="flex justify-between items-center">
            <button id="back-to-options" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
            <div class="flex items-center">
              <div class="refinement-counter mr-4">
                <span>Refinements left: <span id="will-refinements-left"
                    class="font-bold text-navy-blue">3</span></span>
              </div>
              <button id="submit-will" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
            </div>
          </div>
        </div>

        <div class="flex justify-between mt-4">
          <span></span>
          <button id="next-to-coach" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Coach
            ‚û°Ô∏è</button>
        </div>
      </div>
    </div>

    <!-- Coach Step -->
    <div id="coach-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üí¨</span> Coach - ‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä‡∏Å‡∏±‡∏ô‡∏Ñ‡πà‡∏∞</h2>
      <p class="text-gray-600 mb-6">‡∏•‡∏≠‡∏á‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡πÇ‡∏Ñ‡πâ‡∏ä‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏≠‡∏¢‡∏≤‡∏Å‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞?</p>

      <div class="info-section bg-light-mint p-4 rounded-lg mb-4">
        <div class="flex items-center mb-3">
          <span class="text-lg mr-2">üîç</span>
          <strong>‡∏™‡∏£‡∏∏‡∏õ T-GROW ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</strong>
        </div>
        <div class="space-y-2 pl-6">
          <p><span class="step-badge">T</span> <strong>‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</strong> <span id="summary-topic"
              class="text-gray-700"></span></p>
          <p><span class="step-badge">G</span> <strong>‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</strong> <span id="summary-goal"
              class="text-gray-700"></span></p>
          <p><span class="step-badge">R</span> <strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå:</strong> <span id="summary-reality"
              class="text-gray-700"></span></p>
          <p><span class="step-badge">O</span> <strong>‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å:</strong> <span id="summary-options"
              class="text-gray-700"></span></p>
          <p><span class="step-badge">W</span> <strong>‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£:</strong> <span id="summary-will"
              class="text-gray-700"></span></p>
        </div>
      </div>

      <div id="chat-container" class="border rounded-lg p-4 mb-6 bg-white">
        <div id="chat-messages" class="space-y-4 mb-4 max-h-96 overflow-y-auto"></div>

        <div class="flex space-x-2">
          <textarea id="chat-input" class="flex-grow p-3 border rounded-lg"
            placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..."></textarea>
          <button id="send-message" class="btn btn-primary px-4 py-2 rounded-lg font-medium">Send</button>
        </div>
      </div>

      <div class="flex justify-between mt-4 mb-6">
        <button id="back-to-will" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
        <button id="next-to-reflection" class="btn btn-primary px-6 py-2 rounded-lg font-medium hidden">Next: Reflection
          ‚û°Ô∏è</button>
      </div>
    </div>

    <!-- Reflection Step -->
    <div id="reflection-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">‚ú®</span> Reflection - ‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>
      <p class="text-gray-600 mb-6">‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏≠‡∏∞‡πÑ‡∏£‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ô‡∏ö‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞? ‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏á‡∏ï‡πà‡∏≠‡∏î‡∏µ‡∏ô‡∏∞?</p>

      <div id="reflection-container" class="mb-6">
        <div id="reflection-cards" class="card-container"></div>

        <div class="mb-4">
          <textarea id="reflection-input" class="w-full p-4 border rounded-lg mb-4 h-48"
            placeholder="‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏∑‡∏≠..."></textarea>
          <div class="flex justify-between items-center">
            <button id="back-to-coach" class="btn btn-secondary px-6 py-2 rounded-lg font-medium">‚¨ÖÔ∏è Back</button>
            <button id="submit-reflection" class="btn btn-primary px-6 py-2 rounded-lg font-medium">Submit</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Final Step -->
    <div id="final-step" class="step-container">
      <h2 class="text-2xl font-semibold mb-4"><span class="emoji">üéâ</span> ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h2>

      <div class="bg-light-mint p-6 rounded-lg mb-6 border border-mint-green">
        <h3 class="text-lg font-medium text-navy-blue mb-4">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ T-GROW ‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤</h3>

        <div class="space-y-3">
          <div>
            <h4 class="font-medium"><span class="step-badge">T</span> ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ (Topic)</h4>
            <p id="final-topic" class="text-gray-700"></p>
          </div>

          <div>
            <h4 class="font-medium"><span class="step-badge">G</span> ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (Goal)</h4>
            <p id="final-goal" class="text-gray-700"></p>
          </div>

          <div>
            <h4 class="font-medium"><span class="step-badge">R</span> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô (Reality)</h4>
            <p id="final-reality" class="text-gray-700"></p>
          </div>

          <div>
            <h4 class="font-medium"><span class="step-badge">O</span> ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å (Options)</h4>
            <p id="final-options" class="text-gray-700"></p>
          </div>

          <div>
            <h4 class="font-medium"><span class="step-badge">W</span> ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£ (Will)</h4>
            <p id="final-will" class="text-gray-700"></p>
          </div>

          <div>
            <h4 class="font-medium">‚ú® ‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î (Reflection)</h4>
            <p id="final-reflection" class="text-gray-700"></p>
          </div>
        </div>
      </div>

      <div class="feedback-container">
        <h3 class="font-medium mb-2">‚ú® ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ô‡πâ‡∏≠‡∏¢</h3>
        <p id="final-feedback" class="text-gray-700"></p>
      </div>

      <div class="flex justify-center mt-8">
        <button id="restart-process" class="btn btn-primary px-8 py-3 rounded-lg font-medium">Restart üîÑ</button>
      </div>
    </div>
  </div>

  <script>
    // Enhanced function to handle sequential animation of elements
    function animateElementsSequentially(parentSelector, childSelector, baseDelay = 100, increment = 100, animationClass = 'animate-fadeInUp') {
      console.log("Animating elements in:", parentSelector);
      const parent = document.querySelector(parentSelector);
      if (!parent) {
        console.error("Parent element not found:", parentSelector);
        return;
      }

      const children = parent.querySelectorAll(childSelector);
      console.log("Found children:", children.length);

      children.forEach((element, index) => {
        // Add hidden class to start
        element.classList.add('hidden-animation');

        // Calculate delay based on index
        const delay = baseDelay + (index * increment);

        // Set delay
        element.style.animationDelay = `${delay}ms`;

        // Remove hidden class and add animation class after a small delay to ensure DOM rendering
        setTimeout(() => {
          element.classList.remove('hidden-animation');
          element.classList.add(animationClass);
        }, 10);
      });
    }

    // Function to animate elements with different animation types
    function animateElementsWithVariety(parentSelector, animationConfig) {
      const parent = document.querySelector(parentSelector);
      if (!parent) return;

      for (const config of animationConfig) {
        const elements = parent.querySelectorAll(config.selector);
        elements.forEach((element, index) => {
          // Add hidden class to start
          element.classList.add('hidden-animation');

          // Calculate delay based on index and config
          const delay = config.baseDelay + (index * config.increment);

          // Set delay
          element.style.animationDelay = `${delay}ms`;

          // Remove hidden class and add animation class after a small delay
          setTimeout(() => {
            element.classList.remove('hidden-animation');
            element.classList.add(config.animationClass);
          }, 10);
        });
      }
    }

    // Function to animate a newly added card
    function animateNewCard(card, delay = 200) {
      // Apply a single animation to the whole card
      card.style.opacity = '0';
      card.style.transform = 'translateY(20px)';
      card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';

      // Force a reflow to ensure the initial state is applied
      void card.offsetWidth;

      // Then animate it after a delay
      setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
      }, delay);
    }

    // Function to start the coaching process
    function startCoaching() {
      console.log("Start coaching function called");
      const landingPage = document.getElementById('landing-page');

      // Fade out landing page
      landingPage.style.opacity = '0';
      landingPage.style.transition = 'opacity 0.5s ease';

      // After fade out, hide landing page and show first step
      setTimeout(() => {
        landingPage.style.display = 'none';

        // Initialize main application
        document.querySelector('.container').style.display = 'block';

        // Show topic step
        const topicStep = document.getElementById('topic-step');
        if (topicStep) {
          topicStep.classList.add('active');
          console.log("Topic step activated");

          // Animate elements in first step with varied animations
          try {
            animateElementsWithVariety('#topic-step', [
              {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
              {selector: 'p', baseDelay: 350, increment: 150, animationClass: 'animate-slideFromLeft'},
              {selector: 'textarea', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
              {selector: '.refinement-counter', baseDelay: 800, increment: 0, animationClass: 'animate-popIn'},
              {selector: 'button', baseDelay: 950, increment: 0, animationClass: 'animate-scaleIn'}
            ]);
          } catch (e) {
            console.error("Animation error:", e);
          }
        } else {
          console.error("Topic step not found");
        }
      }, 500);
    }

    // State management
    const state = {
      currentStep: 'topic',
      progress: 0,
      steps: ['topic', 'goal', 'reality', 'options', 'will', 'coach', 'reflection', 'final'],
      refinements: {
        topic: 3,
        goal: 3,
        reality: 3,
        options: 3,
        will: 3
      },
      data: {
        topic: '',
        goal: '',
        reality: '',
        options: '',
        will: '',
        reflection: '',
        chatMessages: []
      }
    };

    // Helper function to toggle collapsible sections
    function toggleCollapsible(element) {
      const content = element.nextElementSibling;
      content.classList.toggle('expanded');

      const toggleIcon = element.querySelector('.toggle-icon');
      if (content.classList.contains('expanded')) {
        toggleIcon.textContent = '‚ñ≤';
      } else {
        toggleIcon.textContent = '‚ñº';
      }
    }

    // Show/hide loading overlay
    function showLoading() {
      document.getElementById('loading-overlay').classList.add('active');
    }

    function hideLoading() {
      document.getElementById('loading-overlay').classList.remove('active');
    }

    // API function with standalone loading animation
    async function sendToAPI(prompt, systemMessage) {
      try {
        showLoading();

        const response = await fetch('https://api.openai.com/v1/chat/completions', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': '[X]'
          },
          body: JSON.stringify({
            model: "gpt-4.1-mini",
            messages: [
              {
                role: "system",
                content: systemMessage
              },
              {
                role: "user",
                content: prompt
              }
            ],
            temperature: 0.7,
            max_tokens: 1024,
            top_p: 1
          })
        });

        hideLoading();

        if (!response.ok) {
          const errorData = await response.json();
          console.error('API Error:', errorData);
          throw new Error(`API request failed: ${errorData.error?.message || 'Unknown error'}`);
        }
        const data = await response.json();
        return data.choices[0].message.content;
      } catch (error) {
        console.error('Error:', error);
        hideLoading();
        return `‡πÅ‡∏¢‡πà‡∏à‡∏±‡∏á! ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢: ${error.message} ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ üòÖ`;
      }
    }

    // Function to get feedback from coach
    async function getFeedback(stepName, content) {
      let systemMessage = '';

      switch (stepName) {
        case 'topic':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢‡πÜ`;
          break;
        case 'goal':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${state.data.topic}`;
          break;
        case 'reality':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥`;
          break;
        case 'options':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏ô‡∏≠ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥`;
          break;
        case 'will':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏™‡∏ô‡∏≠ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥`;
          break;
        case 'reflection':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 2-3 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥`;
          break;
        case 'final':
          systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡∏ò‡∏µ T-GROW ‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ä‡∏¥‡πà‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏° ‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 4-5 ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥`;
          break;
      }

      const prompt = `‡∏ô‡∏µ‡πà‡∏Ñ‡∏∑‡∏≠${stepName === 'topic' ? '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠' : stepName === 'goal' ? '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢' : stepName === 'reality' ? '‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô' : stepName === 'options' ? '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å' : stepName === 'will' ? '‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£' : stepName === 'reflection' ? '‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏Ñ‡∏¥‡∏î' : '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'}‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô: "${content}" ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢`;

      return await sendToAPI(prompt, systemMessage);
    }

    // Function to get response for chat
    async function getChatResponse(userMessage) {
      const systemMessage = `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ú‡∏π‡πâ‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡∏™‡∏ô‡∏∏‡∏Å‡∏™‡∏ô‡∏≤‡∏ô ‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏á‡πà‡∏≤‡∏¢ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏∏‡∏ì‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏™‡∏ô‡∏ó‡∏ô‡∏≤‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÑ‡∏î‡πâ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£ T-GROW ‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏î‡∏¢‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ: ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠: ${state.data.topic}, ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢: ${state.data.goal}, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${state.data.reality}, ‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: ${state.data.options}, ‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£: ${state.data.will} ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏ô‡∏ö‡∏ó‡∏ö‡∏≤‡∏ó‡∏Ç‡∏≠‡∏á‡πÇ‡∏Ñ‡πâ‡∏ä‡∏ó‡∏µ‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô ‡πÉ‡∏ä‡πâ‡∏†‡∏≤‡∏©‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏±‡∏ô‡πÄ‡∏≠‡∏á ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡πÅ‡∏ö‡∏ö‡πÑ‡∏ó‡∏¢‡πÜ ‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö ‡πÑ‡∏î‡πâ‡πÉ‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°`;

      return await sendToAPI(userMessage, systemMessage);
    }

    // Function to add a new card with animation
    function addCard(stepName, inputContent, feedbackContent, cardNumber) {
      const cardsContainer = document.getElementById(`${stepName}-cards`);

      const card = document.createElement('div');
      card.className = 'input-card';

      card.innerHTML = `
        <div class="card-header">
          <div>
            <span class="card-number">${cardNumber}</span>
            <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</span>
          </div>
          <span class="text-sm">${new Date().toLocaleDateString('th-TH')}</span>
        </div>
        <div class="card-content">
          <p>${inputContent}</p>
        </div>
        <div class="feedback-section">
          <div class="flex items-center mb-2">
            <span class="text-lg mr-2">‚ú®</span>
            <strong>‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏à‡∏≤‡∏Å‡πÇ‡∏Ñ‡πâ‡∏ä:</strong>
          </div>
          <p>${feedbackContent}</p>
        </div>
      `;

      cardsContainer.appendChild(card);

      // Animate the new card
      animateNewCard(card);

      // Scroll to bottom of cards container
      cardsContainer.scrollTop = cardsContainer.scrollHeight;

      return card;
    }

    // Helper functions
    function updateProgress() {
      const stepIndex = state.steps.indexOf(state.currentStep);
      const progress = (stepIndex / (state.steps.length - 1)) * 100;

      document.getElementById('progressBar').style.width = `${progress}%`;

      // Update step indicators
      state.steps.forEach((step, index) => {
        const element = document.getElementById(`step-${step}`);
        if (element) {
          if (index < stepIndex) {
            element.classList.add('text-navy-blue');
            element.classList.add('font-medium');
          } else if (index === stepIndex) {
            element.classList.add('text-navy-blue');
            element.classList.add('font-medium');
          } else {
            element.classList.remove('text-navy-blue');
            element.classList.remove('font-medium');
          }
        }
      });
    }

    // Function to show the specific step
    function showStep(stepName) {
      // Hide all steps
      document.querySelectorAll('.step-container').forEach(step => {
        step.classList.remove('active');
      });

      // Show the current step
      const currentStep = document.getElementById(`${stepName}-step`);
      if (currentStep) {
        currentStep.classList.add('active');

        // Apply diverse animations based on the step
        setTimeout(() => {
          switch (stepName) {
            case 'topic':
              animateElementsWithVariety('#topic-step', [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'p', baseDelay: 350, increment: 150, animationClass: 'animate-slideFromLeft'},
                {selector: 'textarea', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.refinement-counter', baseDelay: 800, increment: 0, animationClass: 'animate-popIn'},
                {selector: 'button', baseDelay: 950, increment: 0, animationClass: 'animate-scaleIn'}
              ]);
              break;
            case 'goal':
              animateElementsWithVariety('#goal-step', [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'p', baseDelay: 350, increment: 150, animationClass: 'animate-slideFromLeft'},
                {selector: '.info-section', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'textarea', baseDelay: 800, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.refinement-counter', baseDelay: 950, increment: 0, animationClass: 'animate-popIn'},
                {selector: 'button', baseDelay: 1100, increment: 150, animationClass: 'animate-scaleIn'}
              ]);
              break;
            case 'reality':
            case 'options':
            case 'will':
              animateElementsWithVariety(`#${stepName}-step`, [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'p', baseDelay: 350, increment: 0, animationClass: 'animate-slideFromLeft'},
                {selector: '.info-section', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'textarea', baseDelay: 800, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.refinement-counter', baseDelay: 950, increment: 0, animationClass: 'animate-popIn'},
                {selector: 'button', baseDelay: 1100, increment: 150, animationClass: 'animate-scaleIn'}
              ]);
              break;
            case 'coach':
              animateElementsWithVariety('#coach-step', [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'p', baseDelay: 350, increment: 0, animationClass: 'animate-slideFromLeft'},
                {selector: '.info-section', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '#chat-container', baseDelay: 800, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'button', baseDelay: 1100, increment: 150, animationClass: 'animate-scaleIn'}
              ]);
              break;
            case 'reflection':
              animateElementsWithVariety('#reflection-step', [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'p', baseDelay: 350, increment: 0, animationClass: 'animate-slideFromLeft'},
                {selector: 'textarea', baseDelay: 650, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: 'button', baseDelay: 950, increment: 150, animationClass: 'animate-scaleIn'}
              ]);
              break;
            case 'final':
              animateElementsWithVariety('#final-step', [
                {selector: 'h2', baseDelay: 200, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.bg-light-mint', baseDelay: 400, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.bg-light-mint h3', baseDelay: 600, increment: 0, animationClass: 'animate-popIn'},
                {selector: '.bg-light-mint div', baseDelay: 800, increment: 200, animationClass: 'animate-slideFromLeft'},
                {selector: '.feedback-container', baseDelay: 1800, increment: 0, animationClass: 'animate-fadeInUp'},
                {selector: '.feedback-container h3', baseDelay: 2000, increment: 0, animationClass: 'animate-popIn'},
                {selector: '.feedback-container p', baseDelay: 2200, increment: 0, animationClass: 'animate-slideFromLeft'},
                {selector: 'button', baseDelay: 2500, increment: 0, animationClass: 'animate-scaleIn'}
              ]);
              break;
          }
        }, 100);
      }

      // Update state and progress
      state.currentStep = stepName;
      updateProgress();
    }

    // Function to check if a button should be hidden based on refinements
    function updateSubmitButtonVisibility(stepName) {
      const submitButton = document.getElementById(`submit-${stepName}`);
      if (state.refinements[stepName] <= 0 && submitButton) {
        submitButton.style.display = 'none';
      }
    }

    // Chat-related functionality
    let chatTurns = 0;

    // Function to initialize coach chat with typing effect
    async function initializeCoachChat() {
      chatTurns = 0;

      // Clear previous messages
      document.getElementById('chat-messages').innerHTML = '';

      // Add welcome message with typing effect
      const welcomeMessage = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏≤~ üåü ‡∏î‡∏¥‡∏â‡∏±‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏Ñ‡πâ‡∏ä‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡πÄ‡∏´‡πá‡∏ô‡∏ß‡πà‡∏≤‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ "${state.data.topic}" ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞? ‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏´‡∏°‡∏Ñ‡∏∞? üòä`;

      state.data.chatMessages.push({
        role: 'coach',
        content: welcomeMessage
      });

      addChatMessageWithTypingEffect(welcomeMessage, false);
    }

    // Function for animated typing effect in coach chat
    function addChatMessageWithTypingEffect(message, isUser) {
      const chatMessages = document.getElementById('chat-messages');
      const messageElement = document.createElement('div');

      messageElement.classList.add('chat-message', isUser ? 'text-right' : 'text-left');

      // For user messages, just add them instantly
      if (isUser) {
        messageElement.innerHTML = `
          <div class="bg-light-mint ml-auto inline-block p-3 rounded-lg max-w-xs sm:max-w-sm md:max-w-md animate-fadeIn">
            <p class="text-gray-800">${message}</p>
          </div>
        `;

        chatMessages.appendChild(messageElement);
        messageElement.classList.add('visible');

        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;

        return messageElement;
      }

      // For coach messages, add typing effect
      messageElement.innerHTML = `
        <div class="bg-gray-100 mr-auto inline-block p-3 rounded-lg max-w-xs sm:max-w-sm md:max-w-md">
          <p class="text-gray-800" id="typing-text"></p>
        </div>
      `;

      chatMessages.appendChild(messageElement);
      messageElement.classList.add('visible');

      // Scroll to bottom
      chatMessages.scrollTop = chatMessages.scrollHeight;

      // Get the element where we'll show the typing effect
      const typingTextElement = messageElement.querySelector('#typing-text');

      // Start with empty text
      let displayedText = '';
      const fullText = message;
      let charIndex = 0;

      // Function to add one character at a time
      function typeNextChar() {
        if (charIndex < fullText.length) {
          displayedText += fullText.charAt(charIndex);
          typingTextElement.textContent = displayedText;
          charIndex++;

          // Random typing speed for more natural effect
          const typingSpeed = Math.floor(Math.random() * 30) + 20; // 20-50ms

          setTimeout(typeNextChar, typingSpeed);

          // Scroll as we type
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }
      }

      // Start typing effect
      setTimeout(typeNextChar, 200);

      return messageElement;
    }

    // Add Enter key functionality to all textareas
    function setupEnterKeySubmit() {
      // Add event listeners for Enter key in all textareas
      document.querySelectorAll('textarea').forEach(textarea => {
        textarea.addEventListener('keydown', function (event) {
          // If Enter is pressed without Shift, submit the form
          if (event.key === 'Enter' && !event.shiftKey) {
            event.preventDefault(); // Prevent newline

            // Find the corresponding submit button
            const stepId = this.id.split('-')[0];
            const submitButton = document.getElementById(`submit-${stepId}`);

            // If button exists and is not disabled or hidden, click it
            if (submitButton && !submitButton.disabled && submitButton.style.display !== 'none') {
              submitButton.click();
            }
          }
        });
      });
    }

    // Event listeners for topic step
    document.getElementById('submit-topic').addEventListener('click', async function () {
      const topicInput = document.getElementById('topic-input').value.trim();

      if (topicInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏≠‡∏Å‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤~ üôè');
        return;
      }

      state.data.topic = topicInput;

      // Get feedback
      const feedback = await getFeedback('topic', topicInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('topic-cards').children.length;

      // Add card with user input and coach feedback
      addCard('topic', topicInput, feedback, cardCount + 1);

      // Update refinements counter
      state.refinements.topic--;
      document.getElementById('topic-refinements-left').textContent = state.refinements.topic;

      // Clear input for next refinement
      document.getElementById('topic-input').value = '';
      document.getElementById('topic-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡πÄ‡∏õ‡πá‡∏ô...';

      // Hide submit button if no refinements left
      if (state.refinements.topic <= 0) {
        document.getElementById('submit-topic').style.display = 'none';
        document.getElementById('next-to-goal').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-goal').addEventListener('click', function () {
      document.getElementById('selected-topic').textContent = state.data.topic;
      showStep('goal');
    });

    // Event listeners for goal step
    document.getElementById('back-to-topic').addEventListener('click', function () {
      showStep('topic');
    });

    document.getElementById('submit-goal').addEventListener('click', async function () {
      const goalInput = document.getElementById('goal-input').value.trim();

      if (goalInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏≠‡∏Å‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~ üôè');
        return;
      }

      state.data.goal = goalInput;

      // Get feedback
      const feedback = await getFeedback('goal', goalInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('goal-cards').children.length;

      // Add card with user input and coach feedback
      addCard('goal', goalInput, feedback, cardCount + 1);

      // Update refinements counter
      state.refinements.goal--;
      document.getElementById('goal-refinements-left').textContent = state.refinements.goal;

      // Clear input for next refinement
      document.getElementById('goal-input').value = '';
      document.getElementById('goal-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô...';

      // Hide submit button if no refinements left
      if (state.refinements.goal <= 0) {
        document.getElementById('submit-goal').style.display = 'none';
        document.getElementById('next-to-reality').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-reality').addEventListener('click', function () {
      document.getElementById('selected-goal').textContent = state.data.goal;
      showStep('reality');
    });

    // Event listeners for reality step
    document.getElementById('back-to-goal').addEventListener('click', function () {
      showStep('goal');
    });

    document.getElementById('submit-reality').addEventListener('click', async function () {
      const realityInput = document.getElementById('reality-input').value.trim();

      if (realityInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡πà‡∏≤‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÉ‡∏´‡πâ‡∏ü‡∏±‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~ üôè');
        return;
      }

      state.data.reality = realityInput;

      // Get feedback
      const feedback = await getFeedback('reality', realityInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('reality-cards').children.length;

      // Add card with user input and coach feedback
      addCard('reality', realityInput, feedback, cardCount + 1);

      // Update refinements counter
      state.refinements.reality--;
      document.getElementById('reality-refinements-left').textContent = state.refinements.reality;

      // Clear input for next refinement
      document.getElementById('reality-input').value = '';
      document.getElementById('reality-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏•‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡∏ß‡πà‡∏≤...';

      // Hide submit button if no refinements left
      if (state.refinements.reality <= 0) {
        document.getElementById('submit-reality').style.display = 'none';
        document.getElementById('next-to-options').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-options').addEventListener('click', function () {
      document.getElementById('selected-reality').textContent = state.data.reality;
      showStep('options');
    });

    // Event listeners for options step
    document.getElementById('back-to-reality').addEventListener('click', function () {
      showStep('reality');
    });

    document.getElementById('submit-options').addEventListener('click', async function () {
      const optionsInput = document.getElementById('options-input').value.trim();

      if (optionsInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏≠‡∏Å‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~ üôè');
        return;
      }

      state.data.options = optionsInput;

      // Get feedback
      const feedback = await getFeedback('options', optionsInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('options-cards').children.length;

      // Add card with user input and coach feedback
      addCard('options', optionsInput, feedback, cardCount + 1);

      // Update refinements counter
      state.refinements.options--;
      document.getElementById('options-refinements-left').textContent = state.refinements.options;

      // Clear input for next refinement
      document.getElementById('options-input').value = '';
      document.getElementById('options-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏µ‡∏Å...';

      // Hide submit button if no refinements left
      if (state.refinements.options <= 0) {
        document.getElementById('submit-options').style.display = 'none';
        document.getElementById('next-to-will').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-will').addEventListener('click', function () {
      document.getElementById('selected-options').textContent = state.data.options;
      showStep('will');
    });

    // Event listeners for will step
    document.getElementById('back-to-options').addEventListener('click', function () {
      showStep('options');
    });

    document.getElementById('submit-will').addEventListener('click', async function () {
      const willInput = document.getElementById('will-input').value.trim();

      if (willInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ö‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~ üôè');
        return;
      }

      state.data.will = willInput;

      // Get feedback
      const feedback = await getFeedback('will', willInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('will-cards').children.length;

      // Add card with user input and coach feedback
      addCard('will', willInput, feedback, cardCount + 1);

      // Update refinements counter
      state.refinements.will--;
      document.getElementById('will-refinements-left').textContent = state.refinements.will;

      // Clear input for next refinement
      document.getElementById('will-input').value = '';
      document.getElementById('will-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ú‡∏ô‡πÄ‡∏õ‡πá‡∏ô...';

      // Hide submit button if no refinements left
      if (state.refinements.will <= 0) {
        document.getElementById('submit-will').style.display = 'none';
        document.getElementById('next-to-coach').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-coach').addEventListener('click', function () {
      // Update summary
      document.getElementById('summary-topic').textContent = state.data.topic;
      document.getElementById('summary-goal').textContent = state.data.goal;
      document.getElementById('summary-reality').textContent = state.data.reality;
      document.getElementById('summary-options').textContent = state.data.options;
      document.getElementById('summary-will').textContent = state.data.will;

      // Initialize coach chat
      initializeCoachChat();

      showStep('coach');
    });

    // Event listeners for coach step
    document.getElementById('back-to-will').addEventListener('click', function () {
      showStep('will');
    });

    document.getElementById('send-message').addEventListener('click', async function () {
      const chatInput = document.getElementById('chat-input').value.trim();

      if (chatInput === '') {
        return;
      }

      // Add user message
      addChatMessageWithTypingEffect(chatInput, true);

      // Save message
      state.data.chatMessages.push({
        role: 'user',
        content: chatInput
      });

      // Clear input
      document.getElementById('chat-input').value = '';

      // Get response
      const response = await getChatResponse(chatInput);

      // Add coach message with typing effect
      addChatMessageWithTypingEffect(response, false);

      // Save message
      state.data.chatMessages.push({
        role: 'coach',
        content: response
      });

      // Increment chat turns
      chatTurns++;

      // If 2 turns completed, show next button
      if (chatTurns >= 2) {
        document.getElementById('next-to-reflection').classList.remove('hidden');
      }
    });

    document.getElementById('next-to-reflection').addEventListener('click', function () {
      showStep('reflection');
    });

    // Event listeners for reflection step
    document.getElementById('back-to-coach').addEventListener('click', function () {
      showStep('coach');
    });

    document.getElementById('submit-reflection').addEventListener('click', async function () {
      const reflectionInput = document.getElementById('reflection-input').value.trim();

      if (reflectionInput === '') {
        alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ä‡∏£‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏î‡πâ‡∏ß‡∏¢‡∏ô‡∏∞‡∏Ñ‡∏∞~ üôè');
        return;
      }

      state.data.reflection = reflectionInput;

      // Get feedback
      const feedback = await getFeedback('reflection', reflectionInput);

      // Count existing cards to determine the new card number
      const cardCount = document.getElementById('reflection-cards').children.length;

      // Add card with user input and coach feedback
      addCard('reflection', reflectionInput, feedback, cardCount + 1);

      // Disable input after submission
      document.getElementById('reflection-input').disabled = true;
      document.getElementById('submit-reflection').disabled = true;

      // Proceed to final step
      setTimeout(async () => {
        // Update final summary
        document.getElementById('final-topic').textContent = state.data.topic;
        document.getElementById('final-goal').textContent = state.data.goal;
        document.getElementById('final-reality').textContent = state.data.reality;
        document.getElementById('final-options').textContent = state.data.options;
        document.getElementById('final-will').textContent = state.data.will;
        document.getElementById('final-reflection').textContent = state.data.reflection;

        // Get final feedback
        const finalFeedback = await getFeedback('final', JSON.stringify(state.data));
        document.getElementById('final-feedback').textContent = finalFeedback;

        showStep('final');
      }, 1000);
    });

    // Event listener for restart
    document.getElementById('restart-process').addEventListener('click', function () {
      // Reset state
      state.currentStep = 'topic';
      state.progress = 0;
      state.refinements = {
        topic: 3,
        goal: 3,
        reality: 3,
        options: 3,
        will: 3
      };
      state.data = {
        topic: '',
        goal: '',
        reality: '',
        options: '',
        will: '',
        reflection: '',
        chatMessages: []
      };

      // Clear all card containers
      document.getElementById('topic-cards').innerHTML = '';
      document.getElementById('goal-cards').innerHTML = '';
      document.getElementById('reality-cards').innerHTML = '';
      document.getElementById('options-cards').innerHTML = '';
      document.getElementById('will-cards').innerHTML = '';
      document.getElementById('reflection-cards').innerHTML = '';

      // Reset input fields
      document.getElementById('topic-input').value = '';
      document.getElementById('topic-input').placeholder = '‡∏≠‡∏¢‡∏≤‡∏Å‡∏Ñ‡∏∏‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á...';
      document.getElementById('topic-input').disabled = false;

      document.getElementById('goal-input').value = '';
      document.getElementById('goal-input').placeholder = '‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠...';
      document.getElementById('goal-input').disabled = false;

      document.getElementById('reality-input').value = '';
      document.getElementById('reality-input').placeholder = '‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏Ñ‡∏∑‡∏≠...';
      document.getElementById('reality-input').disabled = false;

      document.getElementById('options-input').value = '';
      document.getElementById('options-input').placeholder = '‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡∏Ñ‡∏¥‡∏î‡∏ß‡πà‡∏≤‡∏ô‡πà‡∏≤‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô‡πÑ‡∏õ‡πÑ‡∏î‡πâ‡∏Ñ‡∏∑‡∏≠...';
      document.getElementById('options-input').disabled = false;

      document.getElementById('will-input').value = '';
      document.getElementById('will-input').placeholder = '‡πÅ‡∏ú‡∏ô‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô‡∏Ñ‡∏∑‡∏≠...';
      document.getElementById('will-input').disabled = false;

      document.getElementById('reflection-input').value = '';
      document.getElementById('reflection-input').placeholder = '‡∏™‡∏¥‡πà‡∏á‡∏ó‡∏µ‡πà‡∏â‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏Ñ‡∏∑‡∏≠...';
      document.getElementById('reflection-input').disabled = false;

      // Reset buttons
      document.getElementById('submit-topic').disabled = false;
      document.getElementById('submit-topic').style.display = 'block';
      document.getElementById('submit-goal').disabled = false;
      document.getElementById('submit-goal').style.display = 'block';
      document.getElementById('submit-reality').disabled = false;
      document.getElementById('submit-reality').style.display = 'block';
      document.getElementById('submit-options').disabled = false;
      document.getElementById('submit-options').style.display = 'block';
      document.getElementById('submit-will').disabled = false;
      document.getElementById('submit-will').style.display = 'block';
      document.getElementById('submit-reflection').disabled = false;

      // Reset refinement counters
      document.getElementById('topic-refinements-left').textContent = state.refinements.topic;
      document.getElementById('goal-refinements-left').textContent = state.refinements.goal;
      document.getElementById('reality-refinements-left').textContent = state.refinements.reality;
      document.getElementById('options-refinements-left').textContent = state.refinements.options;
      document.getElementById('will-refinements-left').textContent = state.refinements.will;

      // Hide all next buttons
      document.getElementById('next-to-goal').classList.add('hidden');
      document.getElementById('next-to-reality').classList.add('hidden');
      document.getElementById('next-to-options').classList.add('hidden');
      document.getElementById('next-to-will').classList.add('hidden');
      document.getElementById('next-to-coach').classList.add('hidden');
      document.getElementById('next-to-reflection').classList.add('hidden');

      // Show topic step
      showStep('topic');
    });

    // Initialize with Enter key functionality for all textareas
    setupEnterKeySubmit();

    // Initialize - show topic step
    showStep('topic');
  </script>
</body>

</html>